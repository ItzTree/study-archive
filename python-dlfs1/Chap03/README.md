# Chap03: 신경망

퍼셉트론으로 복잡한 함수도 표현할 수 있지만, 가중치를 설정하는 작업은 사람이 수동으로 해야 한다. 하지만, **신경망**을 이용하여 가중치가 적절한 값을 갖게 할 수 있다.  
```math
y = \begin{cases}
0 & (b\cdot 1 + w_1x_1 + w_2x_2 \leq 0) \\
1 & (b\cdot 1 + w_1x_1 + w_2x_2 > 0)
\end{cases}
```
편향 b를 가중치가 b이고 입력이 1인 뉴런으로 보면 위와 같이 표현할 수 있다. 함수 $h(x)$를 다음과 같이 정의하자.  
```math
h(x) = \begin{cases}
0 & (x \leq 0) \\
1 & (x > 0)
\end{cases}
```
그렇다면 퍼셉트론은 아래의 식으로 표현할 수 있다.  
$$y = h(b + w_1x_1 + w_2x_2)$$
이렇게 $h(x)$와 같이 입력 신호의 총합을 출력 신호로 바꾸는 함수를 <b>활성화 함수(activation function)</b>라고 한다.

### 활성화 함수
퍼셉트론에서 0이라는 임계값을 경계로 출력이 0 또는 1로 바뀌었는데, 이런 함수를 <b>계단 함수(step function)</b>라고 한다.  
신경망에서 자주 사용하는 함수로는 <b>시그모이드 함수(sigmoid function)</b>가 있다.
```math
h(x) = \frac{1}{1 + exp(-x)}
```
계단 함수는 0을 경계로 출력이 갑자기 바뀌지만, 시그모이드 함수의 연속성이 신경망 학습에서 매우 중요한 역할을 한다.  
최근에는 시그모이드 함수 대신 **ReLU 함수**를 주로 이용하기도 한다. $max(0, x)$로 간단하게 나타낼 수 있다.

### 3층 신경망
퍼셉트론은 다시 가중치 합 $a$와 활성화 함수 $h$에 의해 변환된 신호 $z$로 나타낼 수 있다.  
```math
a = w_1x_1 + w_2x_2 + b
```
```math
z = h(a)
```
1층의 1번째 뉴런 $a^{(1)}_1$의 값을 표현하는 과정을 알아보자.  
```math
a^{(1)}_1 = w^{(1)}_{11}x_1 + w^{(1)}_{12}x_2 + b^{(1)}_1
```
행렬 곱을 이용하여 다음 식으로 간소화 할 수 있다.
```math
A^{(1)} = XW^{(1)} + B^{(1)}
```
가중치 합 결과 $A$를 활성화 함수를 통해 다음 은닉층의 입력 $Z$로 바꿔준다. 이 과정을 반복하다가 마지막 은닉층에서 출력층으로 갈 때 사용하는 활성화 함수는 어떤 문제냐에 따라 달라진다. <b>회귀(regression)</b>에는 항등함수를 사용하고, <b>분류(classification)</b>에는 소프트맥스 함수를 사용한다.  

### 출력층 설계하기
분류에서 사용하는 소프트맥스 함수 식은 다음과 같다. 오버플로를 방지하기 위해 지수함수에 어떠한 상수를 더하거나 빼도 결과는 같아진다.
```math
y_k = \frac{exp(a_k)}{\sum^n_{i=1} exp(a_i)} = \frac{exp(a_k + C')}{\sum^n_{i=1}exp(a_i + C')}
```
소프트맥스 함수의 출력은 0부터 1 사이의 실수값을 갖는다. 이 출력값을 모두 더하면 1이 된다는 성질이 있다. 이 성질로 인하여 출력을 **확률**로 해석할 수 있다.  

### 손글씨 숫자 인식
이미 학습된 매개변수를 사용하여 추론 과정만 구현해본다. MNIST 데이터셋을 이용한다.  
mnist.py의 함수 `load_mnist()`는 매개변수를 3개 갖는다. `normalize`을 True로 하면 픽셀값 0\~255가 0\~1 사이의 값으로 정규화된다. `flattern`을 True로 하면 3차원 배열로 이루어진 이미지가 1차원 배열로 바뀐다. `one_hot_label`을 True로 하면 정답을 나타내는 원소만 1의 값을 갖고, 나머지는 0 값을 갖는 배열로 나타난다. False라면 3과 같은 숫자 형태로 정답을 나타낸다.  
이미지 크기가 28 x 28이므로 입력층 뉴런을 784개로 하고, 0~9의 숫자를 구분하는 문제이므로 출력층 뉴런을 10개로 한다.  

여러 입력 데이터를 하나의 <b>배치(batch)</b>로 처리하여 계산할 수 있다. 라이브러리가 큰 배열을 효율적으로 처리하도록 최적화되어 있기 때문에 많은 입력 데이터를 한 번에 전달한다.  