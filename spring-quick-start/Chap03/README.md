# Chap03

책의 Day 2 CLASS 01 ~ Day 2 CLASS 04 파트를 다룬다.

### AOP
비즈니스 컴포넌트 개발에서 가장 중요한 두 가지 원칙은 **낮은 결합도**와 **높은 응집도**를 유지하는 것이다. 스프링의 IoC가 결합도와 관련된 기능이라면, AOP는 응집도와 관련된 기능이다.  
애플리케이션의 메소드는 **몇 줄 안되는 핵심 비즈니스 로직**과 로깅, 예외, 트랜잭션 처리 등의 부가적인 코드로 이루어져 있다. AOP는 이런 부가적인 코드들을 효율적으로 관리하는 데 주목한다. 여기서 등장하는 핵심 개념이 바로 관심 분리(Separation of Concerns)이다. 메소드마다 공통으로 등장하는 로깅 같은 코드들은 횡단 관심, 비즈니스 로직은 핵심 관심이라고 한다.  
- <b>조인포인트(Joinpoint)</b>  
  클라이언트가 호출하는 모든 비즈니스 메소드.  
- <b>포인트컷(Pointcut)</b>  
  조인포인트 중에서도 필터링된 조인포인트.  
  예를 들어, 트랙잭션에 대해서는 등록, 수정 기능의 비즈니스 메소드에 대해서는 동작해야 하지만, 검색 기능의 메소드에 대해서는 동작할 필요가 없다. 포인트컷을 이용하여 특정 메소드를 정확히 지정할 수 있다.  

  포인트컷 표현식에 대해 알아보자.  

  ```
  <aop:pointcut id="allPointcut" expression="execution(* com.springbook.biz..*Impl.*(..))"/>
  ```
  이 포인트컷은 리턴타입과 매개변수를 체크하지 않고, com.springbook.biz 패키지로 시작하는 클래스 중 Impl로 끝나는 클래스의 모든 메소드를 포인트컷으로 설정한 것이다.  
  expression 내용의 맨 앞 `*`은 리턴타입을 모든 리턴타입에 대해 설정한 것이고, `com.springbook.biz..`는 해당 패키지와 그 하위의 모든 패키지를 지정한 것이다. `*Impl`은 Impl로 끝나는 클래스를 고른 것이고, `*(..)`는 메소드 이름과 매개변수 상관 없이 모든 메소드를 포인트컷으로 설정했다고 볼 수 있다.  
- <b>어드바이스(Advice)</b>  
  횡단 관심에 해당하는 공통 기능의 코드.  
  독립된 클래스의 메소드로 작성되며, 스프링 설정 파일을 통해 언제 동작할지 지정할 수 있다. 스프링에서는 어드바이스의 동작 시점을 before, after, after-returning, after-throwing, around 등으로 지정할 수 있다.  
- <b>위빙(Weaving)</b>
  포인트컷으로 지정한 핵심 관심 메소드가 호출될 때, 어드바이스에 해당하는 횡단 관심 메소드가 삽입되는 과정.  
  위빙을 처리하는 방식은 컴파일 타임 위빙과 로딩 타임 위빙, 런타임 위빙이 있지만, 스프링에서는 런타임만 지원한다.  
- <b>애스팩트(Aspect) 또는 어드바이저(Advisor)</b>
  포인트컷과 어드바이스의 결합으로, 어떤 포인트컷 메소드에 어떤 어드바이스 메소드를 실행할지 결정하는 것.  
  애스팩트를 설정할 때에는 `<aop:aspect>` 엘리먼트를 사용하는데, 트랜잭션에서는 `<aop:advisor>` 엘리먼트를 사용한다. 같은 의미의 용어라는 것만 알아두자.  

사용자는 시스템을 사용하며 자연스럽게 비즈니스 컴포넌트의 여러 **조인포인트**를 호출한다. 이 때, 특정 **포인트컷**으로 지정한 메소드가 호출되는 순간, **어드바이스** 객체의 메소드가 실행된다. 이 어드바이스 메소드의 동작 시점을 5가지로 지정할 수 있다. 포인트컷으로 지정한 메소드가 호출될 때, 어드바이스 메소드를 삽입하도록 하는 설정을 **애스팩트**라고 하며, 이 애스팩트 설정에 따라 **위빙**이 처리된다.  

### AOP 엘리먼트
스프링은 AOP 관련 설정을 XML 방식과 어노테이션 방식으로 지원하는데, 우선 XML 방식의 엘리먼트를 알아보도록 하겠다.  
- \<aop:config> 엘리먼트  
  AOP 설정에서 config는 루트 엘리먼트이다. config 엘리먼트는 여러 번 사용할 수 있고, pointcut이나 aspect 엘리먼트를 하위 엘리먼트로 사용할 수 있다.  
- \<aop:pointcut> 엘리먼트  
  포인트컷을 지정하기 위해 사용하며, config의 자식이나 aspect의 자식 엘리먼트로 사용할 수 있다. 하지만, aspect 하위에 설정된 포인트컷은 해당 aspect에서만 사용할 수 있다.  
- \<aop:aspect> 엘리먼트  
  핵심 관심에 해당하는 포인트컷 메소드와 횡단 관심에 해당하는 어드바이스 메소드를 결합하기 위해 사용한다. 애스팩트를 어떻게 설정하느냐에 따라서 위빙 결과가 달라져, AOP에서 가장 중요한 설정이다.  
- \<aop:advisor> 엘리먼트  
  AOP 설정에서 애스팩트를 사용하려면 어드바이스의 아이디와 메소드 이름을 알아야 하는데, 이를 알지 못 할 때에 사용할 수 있다.  


### 커밋
- [78be3c5](https://github.com/ItzTree/study-archive/commit/78be3c5286f9cb212ebb256a01ae1fdec754c097)  
  LogAdvice 클래스와 printLog 메소드를 추가한다. 하지만, 다른 로그 클래스로 바꾸면 모든 소스코드를 수정해야 한다는 단점이 있다.
- [3a1603d](https://github.com/ItzTree/study-archive/commit/3a1603d42a805fe790381a3670cfa890f78cc84b)  
  BoardServiceClient에서 비즈니스 메소드인 insertBoard()와 getBoardList()를 호출했을 때, printLog를 호출한다. AOP를 사용하면 소스 코드 상의 결합 없이 로깅 코드를 호출할 수 있다.  
- [b82eb5a](https://github.com/ItzTree/study-archive/commit/b82eb5ac956cea0c819355047655e2607b504d19)  
  before 어드바이스를 추가한다.  

  ```
  [사전 처리] 비즈니스 로직 수행 전 동작
  ===> JDBC로 insertBoard() 기능 처리
  [사전 처리] 비즈니스 로직 수행 전 동작
  ===> JDBC로 getBoardList() 기능 처리
  ---> BoardVO [seq=6, title=임시 제목, writer=홍길동, content=임시 내용....., regDate=2026-01-10, cnt=0]
  ```
- [f0fac52](https://github.com/ItzTree/study-archive/commit/f0fac52a58f3fcea3e4770ee6736d53b29938a0d)  
  after returning 어드바이스를 추가한다.  
  
  ```
  ===> JDBC로 insertBoard() 기능 처리
  ===> JDBC로 getBoardList() 기능 처리
  [사후 처리] 비즈니스 로직 수행 후 동작
  ---> BoardVO [seq=7, title=임시 제목, writer=홍길동, content=임시 내용....., regDate=2026-01-10, cnt=0]
  ```
